name: Build packages
on: [push]
env:
  CACHIX_CACHE: capack
jobs:
  build-packages:
    runs-on: ubuntu-latest
    steps:
      - name: Install Nix
        run: |
          curl -L https://nixos.org/nix/install | sh
          source ~/.nix-profile/etc/profile.d/nix.sh
      - name: Setup cachix
        run: |
          nix-env -iA cachix -f https://cachix.org/api/v1/install
          cachix use ${CACHIX_CACHE}
      - name: Build packages
        run: nix-shell -p python3Packages.pytest --command "pytest -ra --cachix-name=${CACHIX_CACHE} --push-deps-on-cachix --push-on-cachix"
